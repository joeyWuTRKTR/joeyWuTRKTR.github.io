<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>测试 on Joey Web Dev</title><link>https://example.com/categories/%E6%B5%8B%E8%AF%95/</link><description>Recent content in 测试 on Joey Web Dev</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Thu, 10 Sep 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://example.com/categories/%E6%B5%8B%E8%AF%95/index.xml" rel="self" type="application/rss+xml"/><item><title>Geohash 計算點範圍的好工具</title><link>https://example.com/2020/09/geohash/</link><pubDate>Thu, 10 Sep 2020 00:00:00 +0000</pubDate><guid>https://example.com/2020/09/geohash/</guid><description>&lt;h2 id="introduce-geohash-">Introduce Geohash :&lt;/h2>
&lt;p>Geohash是一種編碼方式
將“經緯度座標”轉成由數字和英文字母所代表的“網格(Grid)”範圍&lt;/p>
&lt;p>舉例來說：&lt;br>
台北101的座標(&amp;ldquo;25.03463&amp;rdquo;, &amp;ldquo;121.56441&amp;rdquo;)&lt;br>
在精度8的情況下會轉換成&amp;quot;wsqqqm2t&amp;quot;
&lt;img src="https://example.com/img/20230720-parking-lot-geohash/taipei101-coordinate-google-map.png"
loading="lazy"
alt="taipei101-coordinate-google-map.png"
>&lt;/p>
&lt;h4 id="試玩看看geohash圖片可以點擊">試玩看看Geohash(圖片可以點擊)：&lt;/h4>
&lt;p>Sunny在哪？
Geek在哪？
&lt;a class="link" href="https://phrozen.github.io/geohash/" target="_blank" rel="noopener"
>&lt;img src="https://example.com/img/20230720-parking-lot-geohash/geohash-demo-tool.png"
loading="lazy"
alt="geohash-demo-tool.png"
>&lt;/a>&lt;/p>
&lt;h2 id="越多編碼數量範圍逐漸縮小">越多編碼數量，範圍逐漸縮小&lt;/h2>
&lt;p>精度1：面積：5,009.4km x 4,992.6km
&lt;img src="https://example.com/img/20230720-parking-lot-geohash/geohash-p-1.png"
loading="lazy"
alt="geohash-p-1.png"
>&lt;/p>
&lt;p>精度2：面積：1,252.3km x 624.1km
&lt;img src="https://example.com/img/20230720-parking-lot-geohash/geohash-p-2.png"
loading="lazy"
alt="geohash-p-2.png"
>&lt;/p>
&lt;p>精度3：面積：156.5km x 156km
&lt;img src="https://example.com/img/20230720-parking-lot-geohash/geohash-p-3.png"
loading="lazy"
alt="geohash-p-3.png"
>&lt;/p>
&lt;p>精度4：面積：39.1km x 19.5km
&lt;img src="https://example.com/img/20230720-parking-lot-geohash/geohash-p-4.png"
loading="lazy"
alt="geohash-p-4.png"
>&lt;/p>
&lt;p>精度5：面積：4.9km x 4.9km
&lt;img src="https://example.com/img/20230720-parking-lot-geohash/geohash-p-5.png"
loading="lazy"
alt="geohash-p-5.png"
>&lt;/p>
&lt;p>精度6：面積：1.2km x 609.4m
&lt;img src="https://example.com/img/20230720-parking-lot-geohash/geohash-p-6.png"
loading="lazy"
alt="geohash-p-6.png"
>&lt;/p>
&lt;p>精度7：面積：152.9m x 152.4m
&lt;img src="https://example.com/img/20230720-parking-lot-geohash/geohash-p-7.png"
loading="lazy"
alt="geohash-p-7.png"
>&lt;/p>
&lt;p>精度8：面積：38.2m x 19m
&lt;img src="https://example.com/img/20230720-parking-lot-geohash/geohash-p-8.png"
loading="lazy"
alt="geohash-p-8.png"
>&lt;/p>
&lt;h1 id="geohash-精度對應面積表">Geohash 精度對應面積表&lt;/h1>
&lt;p>每個層級的解析度：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>層級(Precision)&lt;/th>
&lt;th>面積&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>5,009.4km x 4,992.6km&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&lt;/td>
&lt;td>1,252.3km x 624.1km&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3&lt;/td>
&lt;td>156.5km x 156km&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&lt;/td>
&lt;td>39.1km x 19.5km&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>5&lt;/td>
&lt;td>4.9km x 4.9km&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>6&lt;/td>
&lt;td>1.2km x 609.4m&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>7&lt;/td>
&lt;td>152.9m x 152.4m&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>8&lt;/td>
&lt;td>38.2m x 19m&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>9&lt;/td>
&lt;td>4.8m x 4.8m&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>10&lt;/td>
&lt;td>1.2m x 59.5cm&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>11&lt;/td>
&lt;td>14.9cm x 14.9cm&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>12&lt;/td>
&lt;td>3.7cm x 1.9cm&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h1 id="計算原理">計算原理&lt;/h1>
&lt;h1 id="node-geohash套件">Node Geohash套件&lt;/h1>
&lt;h3 id="npm---ngeohash-httpswwwnpmjscompackagengeohash">npm - ngeohash: &lt;a class="link" href="https://www.npmjs.com/package/ngeohash" target="_blank" rel="noopener"
>https://www.npmjs.com/package/ngeohash&lt;/a>&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">geohash&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ngeohash&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 1. 將經緯度座標轉成Geohash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">taipei101Geohash&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">geohash&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">encode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">25.03463&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">121.56441&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taipei101Geohash&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// wsqqqm2t2，默認層級九
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 2. 將Geohash轉成經緯度座標
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">taipei101LatLon&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">geohash&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">decode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taipei101Geohash&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Geohash轉回經緯度會有誤差
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taipei101LatLon&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">latitude&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// 25.034644603729248
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taipei101LatLon&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">longitude&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// 121.56442880630493
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 3. 找出Geohash周圍八個網格
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">taipei101GeohashNeighbors&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">geohash&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">neighbors&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taipei101Geohash&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taipei101GeohashNeighbors&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// wsqqqm2t2 周圍的八個geohash網格
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// [
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqqqm2t8&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqqqm2t9&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqqqm2t3&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqqqm2t1&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqqqm2t0&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqqqm2mp&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqqqm2mr&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqqqm2mx&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ]
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="其他用法">其他用法：&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">geohash&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ngeohash&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">taipei101Geohash&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">geohash&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">encode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">25.03463&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">121.56441&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taipei101Geohash&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// wsqq, 取層級四
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">taipei101GeohashNeighbors&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">geohash&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">neighbors&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taipei101Geohash&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taipei101GeohashNeighbors&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// [
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqr&amp;#39;, &amp;#39;wsqx&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqw&amp;#39;, &amp;#39;wsqt&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqm&amp;#39;, &amp;#39;wsqj&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqn&amp;#39;, &amp;#39;wsqp&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 1. 找出周圍八個網格中指定位置的網格
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">neighbor&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">geohash&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">neighbor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">taipei101Geohash&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;neighbor = &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">neighbor&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// wsqr，最上面的八個網格
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 2. 找出Geohash網格周圍四個角落的經緯度
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">bbox&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">geohash&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">decode_bbox&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;wsqq&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">bbox&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 最小緯度、最小經度、最大緯度、最大經度
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// [ 24.9609375, 121.2890625, 25.13671875, 121.640625 ]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 3. 找出範圍內的所有geohash網格
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 切到的會算進去嗎？
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">bboxes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">geohash&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">bboxes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">25.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">121.6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">25.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">121.7&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">bboxes&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 找wsqq下層級五的geohash網格
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// [
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqqz&amp;#39;, &amp;#39;wsqwb&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqwc&amp;#39;, &amp;#39;wsqrp&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqx0&amp;#39;, &amp;#39;wsqx1&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqrr&amp;#39;, &amp;#39;wsqx2&amp;#39;,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// &amp;#39;wsqx3&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ]
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://example.com/img/20230720-parking-lot-geohash/geo-decode-bbox.png"
loading="lazy"
alt="geo-decode-bbox.png"
>
周圍四個角落的經緯度&lt;/p>
&lt;p>&lt;img src="https://example.com/img/20230720-parking-lot-geohash/geo-bboxes.png"
loading="lazy"
alt="geo-bboxes.png"
>
周圍的八個Geohash網格&lt;/p>
&lt;h1 id="工作上實際應用">工作上實際應用&lt;/h1>
&lt;p>目前我們在全球各地擁有超過一萬個停車點
在非尖峰時刻資料庫的可以好好消化每一個Request
然而像上/下班的每日尖峰、演唱會等特殊情況，會有一堆人在同時尋找哪裡可以停車
這時候會高達每秒幾十/百個Request進來，Postgres無法即時算出資料，造成資料擁塞等待計算完回傳結果。&lt;/p>
&lt;h3 id="原本的解法">原本的解法：&lt;/h3>
&lt;p>在PostgreSQL用車輛經緯度計算，距離所有停車點橢圓球體5公里內的最近停車點&lt;br>
&lt;img src="https://example.com/img/20230720-parking-lot-geohash/map-circle.png"
loading="lazy"
alt="map-circle.png"
>
（比對數萬個停車點）&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">PostgreSQL:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SELECT ST_DistanceSpheroid(pos, ST_SetSRID(ST_MakePoint(#{lon}, #{lat}), 4326), &amp;#39;SPHEROID[&amp;#34;WGS 84&amp;#34;,6378137,298.257223563]&amp;#39;) as distance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">FROM parking_lot_table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WHERE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ST_DistanceSpheroid(pos, ST_SetSRID(ST_MakePoint(#{lon}, #{lat}), 4326), &amp;#39;SPHEROID[&amp;#34;WGS 84&amp;#34;,6378137,298.257223563]&amp;#39;) &amp;lt; 5000 AND
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ORDER BY distance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LIMIT 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="導入geohash後">導入Geohash後：&lt;/h3>
&lt;p>業務場景為取得車輛方圓5公里內最近的停車點，因此面積是 5km x 5km x pi = 78平方公里&lt;br>
因此選用層級五即可&lt;/p>
&lt;ol>
&lt;li>如果層級五有找到停車點（紅色區域，5km x 5km = 25平方公里），找到停車點-&amp;gt;query&lt;/li>
&lt;li>如果層級五沒有找到停車點，找同層級的其他八個區域（綠色區域），總面積達到225平方公里（25km2 x 9 = 225km2），找到停車點-&amp;gt;query&lt;/li>
&lt;li>如果層級五的九宮格都沒有找到，則沒有滿足條件的停車點
&lt;img src="https://example.com/img/20230720-parking-lot-geohash/map-geo.png"
loading="lazy"
alt="map-geo.png"
>&lt;/li>
&lt;/ol>
&lt;h1 id="結論">結論：&lt;/h1>
&lt;h2 id="1-減少查詢sql次數">1. 減少查詢SQL次數&lt;/h2>
&lt;p>首先可以判斷是否座標周圍有涵蓋目標座標（使用者周圍是否有停車點）&lt;/p>
&lt;h2 id="2-提升sql查詢效率">2. 提升SQL查詢效率&lt;/h2>
&lt;p>第二是可以依照網格層級決定篩選多少量級的資料
藉由判斷是否在自身geohash網格、周圍八個geohash網格，將篩選出的資料範圍縮小&lt;/p></description></item><item><title>Chinese Test</title><link>https://example.com/2020/09/test-chinese/</link><pubDate>Wed, 09 Sep 2020 00:00:00 +0000</pubDate><guid>https://example.com/2020/09/test-chinese/</guid><description>&lt;img src="https://example.com/2020/09/test-chinese/helena-hertz-wWZzXlDpMog-unsplash.jpg" alt="Featured image of post Chinese Test" />&lt;h2 id="正文测试">正文测试&lt;/h2>
&lt;p>而这些并不是完全重要，更加重要的问题是， 带着这些问题，我们来审视一下学生会退会。 既然如何， 对我个人而言，学生会退会不仅仅是一个重大的事件，还可能会改变我的人生。 我们不得不面对一个非常尴尬的事实，那就是， 可是，即使是这样，学生会退会的出现仍然代表了一定的意义。 学生会退会，发生了会如何，不发生又会如何。 经过上述讨论， 生活中，若学生会退会出现了，我们就不得不考虑它出现了的事实。 学生会退会，到底应该如何实现。 这样看来， 在这种困难的抉择下，本人思来想去，寝食难安。 对我个人而言，学生会退会不仅仅是一个重大的事件，还可能会改变我的人生。 就我个人来说，学生会退会对我的意义，不能不说非常重大。 莎士比亚曾经提到过，人的一生是短的，但如果卑劣地过这一生，就太长了。这似乎解答了我的疑惑。 莫扎特说过一句富有哲理的话，谁和我一样用功，谁就会和我一样成功。这启发了我， 对我个人而言，学生会退会不仅仅是一个重大的事件，还可能会改变我的人生。 学生会退会，到底应该如何实现。 一般来说， 从这个角度来看， 这种事实对本人来说意义重大，相信对这个世界也是有一定意义的。 在这种困难的抉择下，本人思来想去，寝食难安。 了解清楚学生会退会到底是一种怎么样的存在，是解决一切问题的关键。 一般来说， 生活中，若学生会退会出现了，我们就不得不考虑它出现了的事实。 问题的关键究竟为何？ 而这些并不是完全重要，更加重要的问题是。&lt;/p>
&lt;p>奥斯特洛夫斯基曾经说过，共同的事业，共同的斗争，可以使人们产生忍受一切的力量。　带着这句话，我们还要更加慎重的审视这个问题： 一般来讲，我们都必须务必慎重的考虑考虑。 既然如此， 这种事实对本人来说意义重大，相信对这个世界也是有一定意义的。 带着这些问题，我们来审视一下学生会退会。 我认为， 我认为， 在这种困难的抉择下，本人思来想去，寝食难安。 问题的关键究竟为何？ 每个人都不得不面对这些问题。 在面对这种问题时， 要想清楚，学生会退会，到底是一种怎么样的存在。 我认为， 既然如此， 每个人都不得不面对这些问题。 在面对这种问题时， 那么， 我认为， 学生会退会因何而发生。&lt;/p>
&lt;h2 id="引用">引用&lt;/h2>
&lt;blockquote>
&lt;p>思念是最暖的忧伤像一双翅膀&lt;br>
让我停不了飞不远在过往游荡&lt;br>
不告而别的你 就算为了我着想&lt;br>
这么沉痛的呵护 我怎么能翱翔&lt;/p>
&lt;p>&lt;em>&lt;a class="link" href="https://www.youtube.com/watch?v=3aypp_YlBzI" target="_blank" rel="noopener"
>最暖的憂傷 - 田馥甄&lt;/a>&lt;/em>&lt;/p>
&lt;/blockquote>
&lt;h2 id="图片">图片&lt;/h2>
&lt;p>&lt;img src="https://example.com/2020/09/test-chinese/florian-klauer-nptLmg6jqDo-unsplash.jpg"
width="667"
height="1000"
srcset="https://example.com/2020/09/test-chinese/florian-klauer-nptLmg6jqDo-unsplash_hu595aaf3b3dbbb41af5aed8d3958cc9f9_13854_480x0_resize_q75_box.jpg 480w, https://example.com/2020/09/test-chinese/florian-klauer-nptLmg6jqDo-unsplash_hu595aaf3b3dbbb41af5aed8d3958cc9f9_13854_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="Photo by Florian Klauer on Unsplash"
class="gallery-image"
data-flex-grow="66"
data-flex-basis="160px"
> &lt;img src="https://example.com/2020/09/test-chinese/luca-bravo-alS7ewQ41M8-unsplash.jpg"
width="1000"
height="667"
srcset="https://example.com/2020/09/test-chinese/luca-bravo-alS7ewQ41M8-unsplash_hu0a3f1163de68d0b9471979ebf0ecf11e_32400_480x0_resize_q75_box.jpg 480w, https://example.com/2020/09/test-chinese/luca-bravo-alS7ewQ41M8-unsplash_hu0a3f1163de68d0b9471979ebf0ecf11e_32400_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="Photo by Luca Bravo on Unsplash"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="359px"
>&lt;/p>
&lt;p>&lt;img src="https://example.com/2020/09/test-chinese/helena-hertz-wWZzXlDpMog-unsplash.jpg"
width="1000"
height="750"
srcset="https://example.com/2020/09/test-chinese/helena-hertz-wWZzXlDpMog-unsplash_hu45a5e3ad5e058da6a00650ed8fd40bea_15530_480x0_resize_q75_box.jpg 480w, https://example.com/2020/09/test-chinese/helena-hertz-wWZzXlDpMog-unsplash_hu45a5e3ad5e058da6a00650ed8fd40bea_15530_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="Photo by Helena Hertz on Unsplash"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
> &lt;img src="https://example.com/2020/09/test-chinese/hudai-gayiran-3Od_VKcDEAA-unsplash.jpg"
width="667"
height="1000"
srcset="https://example.com/2020/09/test-chinese/hudai-gayiran-3Od_VKcDEAA-unsplash_hub241c2a9c7a2caf7e16a2a5bbc7141ff_18711_480x0_resize_q75_box.jpg 480w, https://example.com/2020/09/test-chinese/hudai-gayiran-3Od_VKcDEAA-unsplash_hub241c2a9c7a2caf7e16a2a5bbc7141ff_18711_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="Photo by Hudai Gayiran on Unsplash"
class="gallery-image"
data-flex-grow="66"
data-flex-basis="160px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-markdown" data-lang="markdown">&lt;span class="line">&lt;span class="cl">![&lt;span class="nt">Photo by Florian Klauer on Unsplash&lt;/span>](&lt;span class="na">florian-klauer-nptLmg6jqDo-unsplash.jpg&lt;/span>) ![&lt;span class="nt">Photo by Luca Bravo on Unsplash&lt;/span>](&lt;span class="na">luca-bravo-alS7ewQ41M8-unsplash.jpg&lt;/span>)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">![&lt;span class="nt">Photo by Helena Hertz on Unsplash&lt;/span>](&lt;span class="na">helena-hertz-wWZzXlDpMog-unsplash.jpg&lt;/span>) ![&lt;span class="nt">Photo by Hudai Gayiran on Unsplash&lt;/span>](&lt;span class="na">hudai-gayiran-3Od_VKcDEAA-unsplash.jpg&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>相册语法来自 &lt;a class="link" href="https://typlog.com/" target="_blank" rel="noopener"
>Typlog&lt;/a>&lt;/p></description></item></channel></rss>